# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

flod is an R package for statistical learning on flow cytometry data. The package bridges the gap between flowCore's flowSet S4 class (which stores .fcs file data) and the tidyverse/tidymodels ecosystem, enabling standard data science workflows on flow cytometry data.

**Key Goals:**
1. Quickly convert flow cytometry data into tibbles for tidyverse/tidymodels workflows
2. Provide domain-specific functions for plotting, transforming, and gating familiar to flow cytometry scientists

**Status:** Under heavy development and subject to sweeping changes (see R/zzz.R:2)

## Core Architecture

### Data Flow
The primary data structure is flowCore's `flowSet` (S4 class) which stores .fcs files. The main function `to_tibble()` (R/to_tibble.R) converts flowSet objects into tibbles by extracting:
- `sample_names`: Sample identifiers from pData rownames
- `exprs`: Expression matrices from each flowFrame
- `keywords`: Metadata keywords from each flowFrame
- `meta_data`: phenoData from the flowSet

The conversion uses internal getter functions (get_sample_names, get_exprs, get_keywords, get_meta_data) that abstract flowCore API calls.

### Dependencies
- **flowCore**: Core dependency for .fcs file handling and flowSet/flowFrame classes
- **tibble**: Output data structure
- **cli**: User-facing error messages
- **ggplot2**: Visualization support

## Common Commands

### Package Development
```r
# Install dependencies and load package
devtools::load_all()

# Run all tests
devtools::test()

# Run specific test file
testthat::test_file("tests/testthat/test-to_tibble.R")

# Check package (R CMD check)
devtools::check()

# Build documentation
devtools::document()

# Build README from README.Rmd
rmarkdown::render("README.Rmd")

# Build and preview pkgdown site locally
pkgdown::build_site()
```

### Testing
- Tests use testthat (edition 3)
- Test files: tests/testthat/test-*.R
- Run tests: `devtools::test()` or `testthat::test_check("flod")`

### CI/CD
- R-CMD-check runs on multiple platforms (Ubuntu, Windows, macOS) with multiple R versions (devel, release, oldrel-1)
- pkgdown site auto-deploys to GitHub Pages at https://hugoakerstrand.github.io/flod/
- Code coverage tracked via codecov

## File Structure Notes

- **R/**: Source code for exported functions
  - to_tibble.R: Main conversion function
  - zzz.R: Package startup messages (.onAttach hook)
- **tests/testthat/**: Unit tests following testthat structure
- **vignettes/**: Package vignettes (.Rmd files)
- **man/**: Auto-generated documentation (DO NOT edit manually)
- **docs/**: pkgdown site output (auto-generated)
- **NAMESPACE**: Auto-generated by roxygen2 (DO NOT edit manually)

## Development Practices

### Documentation
- Use roxygen2 for documentation (@param, @returns, @export, @description)
- Markdown support enabled (Roxygen: list(markdown = TRUE))
- Update README.md by editing README.Rmd, never edit README.md directly

### Error Handling
- Use `cli::cli_abort()` for user-facing errors with styled output
- Validate inputs at function boundaries (see to_tibble.R:20-28)

### Testing
- Configure testthat edition 3 in DESCRIPTION
- Test file naming: test-<source_file>.R
